## 现状审计
- 代码目录仅含设计文档：`c:\personal\task\design.md`，暂无应用代码与构建脚手架。
- 目标：按设计稿实现一个“项目为中心的紧凑型待办”桌面应用，并产出 Windows `exe`。

## 技术选型
- 框架：Tauri + 前端（React + TypeScript）。
  - 原因：体积小、原生打包到 `exe`、适合本地数据与附件管理、Windows 兼容好。
- 存储：本地 JSON + 附件目录。
  - `data/app-state.json`（应用状态）、`data/attachments/{taskId}`（附件存储）。
- 表格组件：自研简表或使用 Minimal Table（避免依赖过重）。

## 项目结构
- `src/`：前端页面（项目列表、工具栏、任务表格、详情抽屉）。
- `src/features/`：筛选视图、排序方案、批量粘贴、导入预览、附件管理模块。
- `src/lib/`：CSV解析、DSL搜索、校验器、文件服务（读写/缩略图）。
- `src/types/`：`Project/Task/AppState/SavedFilter/...`（与设计稿一致）。
- `src/tests/`：单元与集成用例（CSV、导入预览、DSL、附件约束等）。
- `tauri/`：Tauri 配置与 Rust 命令（文件访问、安全白名单）。
- `data/`：运行时数据与附件。

## 功能实现（对应设计稿章节）
1. 基础功能（3章）：
- 项目与事项 CRUD；分组切换；多选批量（状态/责任人/截止期/项目）。
- 行内编辑与快捷键：↑↓、Enter、Esc、Ctrl+S、Ctrl+D。
2. CSV（5章）：
- 导入预览与映射；必填与合法校验；失败 CSV 导出；支持 UTF-8/GBK。
- 导出按当前筛选与列顺序；示例 CSV 校验。
3. 筛选/排序（9.1/9.2）：
- 保存筛选视图与方案；默认三段排序；数量与命名约束。
4. 批量粘贴（9.3）：
- 从剪贴板解析多行；默认值与错误提示；失败明细弹窗。
5. 自定义列/列模板（9.5/9.6/9.7）：
- 列设置与模板切换；责任人字典与自动建议；数量限制与去重。
6. 逾期与颜色策略（9.8）：
- 阈值设定；近到期/逾期高亮；方案切换。
7. 子任务与依赖（9.9）：
- 检查清单与完成率汇总；阻塞提示；禁止循环依赖。
8. 撤销与历史（9.10）：
- 10步撤销/重做；批次化历史；附件操作仅入历史不进入撤销。
9. 搜索 DSL（9.11/12章）：
- 解析器与实时校验；语法错误高亮与建议修正。
10. 附件（15章）：
- 上传/拖拽/粘贴图片；类型与容量限制；缩略图生成；ZIP 导入导出，错误恢复。
11. 权限与隐私（3章）：
- 明确单人本地使用，无账号与多人协作，不含分享功能。

## 构建与交付
- 初始化：`npm create tauri-app` 或使用官方模板并替换为 React+TS。
- 开发启动：`npm run tauri dev`（Windows）。
- 打包生成 exe：`npm run tauri build`，输出目录 `src-tauri/target/release/`，产物为 `app_name.exe`。
- 图标与元数据：在 `tauri.conf.json` 配置应用名称、版本、图标与文件访问白名单（`data/**`）。

## 质量保障
- 单元测试：
  - CSV解析、DSL查询、校验器、排序与筛选、附件类型/大小限制。
- 集成测试：
  - 导入预览→导入→失败 CSV、批量粘贴、ZIP 导入导出。
- 验收用例：
  - 见设计稿 `13-15章` 用例，逐条执行并出具结果快照。

## 风险与回滚
- 文件权限：Windows 下路径与权限提示需准确（避免 UAC 限制），失败需给出改用用户目录建议。
- 大数据量：2,000 行以内保证渲染性能；超出给出性能提示与分页建议。
- 回滚：每次实现按功能小步提交，保留可运行状态；失败回退至上一个可运行版本。

## 预计工作流（PowerShell）
- 初始化：`npm create tauri-app` → 选择 React+TS → 安装依赖。
- 开发：`npm run tauri dev`。
- 构建：`npm run tauri build`。
- 交付：提供 `exe`、`README-运行说明.txt`（仅在你确认后生成），以及示例 `CSV/ZIP` 用于验收。

## 需要你确认的细节（若不回复则采用默认）
- 应用名称与图标：默认 `ProjectTasks` 与简洁图标。
- 数据路径：默认 `data/` 置于应用同级目录；可改为用户文档目录。
- 语言与日期格式：默认中文、`YYYY-MM-DD`。
- 是否保留示例数据与示范视图：默认提供一份 `demo.csv` 与两条 SavedFilter。