## 目标
- 在不折叠/不隐藏关键信息的前提下，缓解横向滚动压力
- 将长文本与次要列“栈叠”到同一行的第二层，主列保持一行展示
- 保持现有数据结构/API不变，兼顾性能与操作效率

## UI布局
- 行模板：
  - 主层（Row Top）：关键列（如 项目/标题/状态/优先级/截止日期/责任人）
  - 次层（Row Bottom）：长文本与次要列（如 最近进展/下一步/详情/附件/子任务/自定义长文本）
- 控件：
  - 行右侧显示开关：[展开长文本] / [收起]
  - 顶部工具区增加：栈叠开关（全局）与“在紧凑模式下自动栈叠”选项
- 视觉：
  - 次层淡背景与细分隔线；与主层对齐列标；长文本允许换行
  - 在次层列头简化为标签（如“进展/下一步/详情”）以节省空间

## 交互细节
- 默认策略：
  - 桌面紧凑模式 → 自动栈叠（次层显示最近进展/下一步/详情）
  - 常规模式 → 次层默认收起，点击“展开长文本”在所有行或单行展开
- 单行控制：
  - 每一行独立控制展开/收起；记忆最后一次状态（滚动后保持）
- 键盘：
  - Enter 编辑；Esc 取消；Alt+↓ 展开栈叠层；Alt+↑ 收起
- 排序/过滤：
  - 排序、过滤、分组对主层与次层列一致生效（仅影响数据顺序，不影响展开状态）

## 技术实现
- 列归类：
  - 在 `columnConfig` 增加 `stacked: string[]`（次层列名单）与 `stackBehavior: 'auto'|'always'|'off'`
  - 默认：`stacked=['latestProgress','nextStep','notes','attachments','checklist']`
- 渲染层：
  - `TaskTable` 将每行渲染为两条 `<tr>` 或一个 `<tr>` 内两层容器（建议一个 `<tr>` 内：`<div class='row-top'>` 和 `<div class='row-bottom'>`）
  - 主层按现有 `columns` 过滤出非栈叠列；次层渲染 `stacked` 中出现在当前列配置的列
- Sticky列与宽度：
  - 主层继续 sticky（项目/标题等）；次层与主层在 sticky 列下对齐（使用 CSS grid + same column-template）
  - 保留现有 `computeColumnWidths`，次层长文本列使用最小宽度保护与自动换行
- 编辑态：
  - 栈叠层中的列支持行内编辑（textarea/input/select 与现状一致）
  - 编辑态下行高自增，保存/取消与删除按钮保持在操作列
- 性能与虚拟化：
  - 不改变数据量处理方式；仅增加一层容器；尽量避免多次 reflow
  - 对行展开/收起做动画时使用 `max-height` 过渡与 `will-change: height`，并节流滚动事件

## 配置与迁移
- 新增配置字段：`columnConfig.stacked`、`columnConfig.stackBehavior`
- 迁移默认值：自动填充默认栈叠列；不影响现有 `columns/pinned/labels`
- 用户在“列编辑”中可将任意列加入/移除栈叠名单，并切换行为

## 动画与反馈
- 展开/收起：200ms 高度过渡与淡入；行选中高亮覆盖栈叠层
- 透镜（可选）：在次层长文本列提供 🔍 透镜，悬浮显示完整文本

## 兼容与导出
- 导出 CSV：保留所有列（包括栈叠列），不改变导出结构
- 点击列头排序的箭头显示不变；次层列头标签不参与排序箭头（避免干扰）

## UI草图
```
┌ 行（主层）: [项目] [标题] [状态] [优先级] [截止日期] [现场] [产线] [操作] ┐
│ 项目A   事项X    进行中     高        11-30       Alex   Lee    [编辑] │
└──────────────────────────────────────────────────────────────────────┘
┌ 行（次层）: [最近进展] [下一步] [详情] [附件] [子任务] ────────────────┐
│   已对齐签署   跟进签署   … …    (2)        (1/3)                     │
└──────────────────────────────────────────────────────────────────────┘
（收起时隐藏次层；单行或全局控制）
```

## 实施步骤
1. 扩展 `ColumnConfig` 与迁移默认值（仅配置，API不变）
2. `TaskTable` 重构行模板为主层/次层渲染；保持编辑/选择/删除逻辑
3. 样式：新增 `.row-top/.row-bottom`、行高与动画；sticky对齐
4. 工具栏：新增栈叠开关与模式选择（压缩/换行与栈叠联动）
5. 验证：排序/过滤/分组/导出一致；性能检查（1–10万行）
6. 交付绿色版 exe

## 风险与缓解
- 行高增加影响密度 → 默认仅紧凑模式自动栈叠；常规模式收起
- Sticky对齐复杂 → 统一宽度计算与 grid 模板；对齐测试覆盖
- 编辑态空间不足 → 编辑态行增高与次层展开优先

如认可该优化方案，我将按此实现并交付绿色版。