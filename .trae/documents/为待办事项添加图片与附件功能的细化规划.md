## 目标
- 在保持“项目中心+紧凑表格”的前提下，为任务提供稳定的本地附件支持：图片粘贴/拖拽、文件上传、预览、重命名/删除、导出打包，不引入花哨功能。

## 范围与原则
- 范围：附件的采集、展示、存储、导入/导出、错误处理与容量控制。
- 原则：本地存储、轻量预览、严格容量与类型限制、可追溯操作、CSV仍做结构数据导入导出，附件采用ZIP打包方案。

## 规格要点
1. 入口与交互：
- 详情抽屉“附件”区：按钮“上传”、拖拽框、支持图片粘贴（剪贴板）；缩略图列表+文件名+大小。
- 操作：预览（图片内嵌、PDF新窗口、音频轻量播放）、下载、重命名、删除（二次确认），复制路径。
- 快捷键：Delete 删除、F2 重命名。

2. 支持类型与限制：
- 类型：图片（png/jpg/webp）、PDF、音频（mp3/wav），可扩展 office 文档。
- 大小：单文件≤10MB；每任务最多100个附件；全局占用≤1GB（超限禁止上传并提示）。

3. 存储与路径：
- 路径：`data/attachments/{taskId}/`；图片缩略图 `data/attachments/{taskId}/thumbs/`。
- 文件名安全化：去除非法字符，保留扩展名；重复名自动追加 `-1,-2`。
- 去重：保存前计算 SHA-256，重复内容仅建立引用不重复存储。

4. 数据结构：
- Task.attachments：`{ id,name,type,size,path,createdAt,hash? }[]`，缩略图地址按约定生成。
- HistoryLog：新增“附件新增/删除/重命名”批次记录。

5. 导入/导出：
- CSV不承载附件内容；新增“导出为ZIP（含CSV与附件）”。
- ZIP结构：`tasks.csv` + `attachments/{taskId}/files...` + `attachments/{taskId}/thumbs...`。
- 导入ZIP：先导入CSV，再根据目录结构挂载附件；缺失文件记录为失败并生成错误报告。

6. 错误处理与提示：
- 超类型/超大小/超配额/读写失败均给出明确错误原因与建议（压缩/清理）。
- 删除为不可逆操作，需二次确认；重命名需保持扩展名一致或二次确认变更。

7. 验收用例：
- 粘贴截图生成PNG并出现缩略图；拖拽PDF可预览；超过10MB拒绝上传并提示；重复文件去重；导出ZIP含CSV与附件；导入ZIP正确还原。

## 文件更新
- 在 `design.md` 中新增“附件与图片”章节，细化交互、限制、数据结构、存储路径与导入导出。
- 更新“数据结构扩展”和“导入/错误报告规范”中与附件相关的定义与流程。

## 不创建新文件
- 仅编辑现有设计稿以形成可实施规格。