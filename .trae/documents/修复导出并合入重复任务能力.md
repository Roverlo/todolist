## 导出按钮修复

- 现状：使用 `Blob + <a download>` 在 Tauri WebView 下可能被拦截或无效，导致点击无响应。
- 方案：改用 Tauri API 实现原生保存对话框与文件写入。
  - 新增工具函数：`saveCsvWithTauri(name, content)`，使用 `@tauri-apps/api/dialog.save` 获取路径、`@tauri-apps/api/fs.writeFile` 写入；默认文件名 `tasks-YYYYMMDD-HHmmss.csv`。
  - 保留浏览器回退：若 `window.__TAURI__` 不可用则使用现有 `triggerDownload`。
  - 兼容 Excel：CSV 添加 UTF-8 BOM、行末使用 CRLF。
  - 位置：`src/utils/csv.ts` 新增保存函数；`PrimaryToolbar.tsx` 的 `handleExport` 调用新函数。
  - 错误处理：保存失败时提示（使用简单 `alert`），不引入新库。

## 重复任务能力

- 目标：支持每周/每月重复任务；既可固定在具体周几/几号，也可“本周/本月需做但不固定日期”。

### 数据模型
- `RecurringTemplate`：
  - `id`, `projectId`, `title`, `status`, `priority`, `defaults`（owners、tags、nextStep、notes 等可选）
  - `schedule`：
    - `type`: `weekly | monthly`
    - `daysOfWeek?`: 数组（0-6，周日-周六）
    - `dayOfMonth?`: 数字（1-31）
    - `flexible`: 布尔；true 表示该周期内要做但不固定具体某天
  - `dueStrategy`: `sameDay | endOfWeek | endOfMonth | none`
  - `active`: 布尔
- 任务关联字段：在 `Task.extras` 中记录 `recurrenceId` 与 `periodKey`（如 `2025-W47` 或 `2025-11`），用于去重。

### 生成器逻辑
- 新增 `materializeRecurringTasks(now?: Date)`：
  - 遍历启用的模板，计算当前周期的目标日期集：
    - weekly 固定：当周对应 `daysOfWeek`
    - monthly 固定：当月 `dayOfMonth`（溢出按月底处理）
    - flexible：每周生成 1 条（periodKey = 当周）或每月生成 1 条（periodKey = 当月），`dueDate` 根据 `dueStrategy`（周末/月底/无）。
  - 对于每个目标日期，若当前周期已有同模板同 `periodKey` 的任务，则跳过；否则创建任务。
- 调用时机：
  - 应用启动后、日期变更时（简单方案：每次启动都运行一次即可）。
  - 提供手动触发按钮“生成重复任务”。

### Store 接入
- 在 `appStore.ts`：
  - 新增 `recurringTemplates: RecurringTemplate[]`。
  - 新增 API：`addRecurringTemplate`、`updateRecurringTemplate`、`deleteRecurringTemplate`、`materializeRecurringTasks`。
  - 在 `initialData` 初始化一个空数组。

### UI 设计
- 新增工具栏按钮“重复任务”，打开 `RecurringModal`：
  - 列表 + 编辑表单：项目、标题、频率（周/月）、固定日设置（多选周几或输入几号）、是否灵活、不固定任务的 `dueStrategy`、默认字段。
  - 操作：新增、保存、删除；按钮“生成本周/本月任务”。
- 任务生成后在主表中可见；灵活任务的 `dueDate` 可为空或按策略自动填充。

## 实施阶段

### 阶段 1：导出修复
- 目标：点击“导出”弹原生保存对话框并写入文件。
- 成功标准：生成 CSV，Excel 打开中文正常。
- 测试：无任务/少量任务/多任务，手动验证保存与文件内容。

### 阶段 2：数据模型与 Store API
- 目标：定义 `RecurringTemplate`，实现 Store 方法与生成器。
- 成功标准：手动插入模板后可生成当周/当月任务且不重复。
- 测试：周模板（月模板）固定/灵活、跨月边界、月底小月（28-30）。

### 阶段 3：UI 与交互
- 目标：完成 `RecurringModal`，支持 CRUD 与手动生成。
- 成功标准：通过界面新增模板并生成任务；编辑/删除模板生效。
- 测试：各字段交互与生成按钮。

### 阶段 4：集成与回归
- 目标：应用启动自动生成当期任务；整体回归。
- 成功标准：导入、导出、筛选、分组功能均正常；无横向滑条回归通过。

## 备注
- 不引入新依赖；使用 Tauri 官方 API。
- 保持改动最小化、与现有样式与状态管理一致。